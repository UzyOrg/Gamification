<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=0, viewport-fit=cover"
    />
    <title>RappiCard Legacy</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Lilita+One&display=swap"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <div class="main-container">
      <img class="background" src="./background.png" alt="" />
      <img
        class="close-button"
        src="./back-icon.svg"
        onclick="brazeBridge.logClick();brazeBridge.closeMessage()"
      />
      <div class="caracter-modal">
        <img
          class="background"
          src="https://braze-images.com/appboy/communication/assets/image_assets/images/66bc41d3d0d80700634db9fb/original.png?1723613648"
          alt=""
        />
        <img
          src="./back-icon.svg"
          id="close-button-modal"
          class="close-button"
        />
        <p class="caracter-modal-title" id="modal-title">¡GANASTE!</p>
        <div class="modal-lottie-container">
          <lottie-player
            class="modal-lottie"
            id="Ajolote-Level-1-Animacion"
            src="https://growth-cdn.business-systems-rappicard.mx/Gamification/Ajolote-Nivel-2-Animacion.json"
            background="transparent"
            speed="1"
            direction="2"
            mode="normal"
            autoplay
            loop
          ></lottie-player>
        </div>
        <div class="recompensa-container">
          <p class="title">Recompensa</p>
          <hr />
          <div class="recompensa-description">
            <p>Ganaste 3% de cashback en tu siguinete compra</p>
          </div>
        </div>
        <div class="comercios-container">
          <div id="Gasolina" class="comercios"><p>Gasolina</p></div>
          <div id="Farmacias" class="comercios"><p>Farmacias</p></div>
          <div id="Uber" class="comercios"><p>Uber</p></div>
          <div id="Conveniencia" class="comercios"><p>Conveniencia</p></div>
          <div id="Supermercado" class="comercios"><p>Supermercados</p></div>
        </div>
        <button class="modal-button" id="modal-button">Usar mi promo</button>
      </div>
      <div class="modal-overlay"></div>
      <div class="modal-info">
        <img
          src="./close-button-x.svg"
          id="close-modal-info"
          style="color: black; float: right"
        />
        <div class="text-info-container">
          <p>Has ganado:</p>
          <p id="premio-info-container"></p>
          <img
            id="chest-info-container"
            src="https://growth-cdn.business-systems-rappicard.mx/Gamification/cofre-nivel-1.png"
            alt=""
          />
        </div>
        <p class="tyc">Aplican <a href="www.google.com">TyC</a></p>
      </div>
      <!-- Inician los niveles -->
      <div class="mainPage-container">
        <img
          class="img-title"
          src="https://braze-images.com/appboy/communication/assets/image_assets/images/66bc41cffbc3f20064c786a6/original.png?1723613647"
          alt=""
        />
        <div class="mision-actual-container">
          <p class="mision-header">Misión Actual</p>
          <hr />
          <p id="meta-actual-text">...</p>
        </div>
        <div class="progress-container">
          <div class="column caracter-column">
            <div id="caracter-lvl-1" class="caracter-container">
              <lottie-player
                id="ajolote-1-discover-animation"
                class="caracter-animation caracter"
                src="https://growth-cdn.business-systems-rappicard.mx/Gamification/Nivel-1-Icono.json"
                background="transparent"
                speed="1"
                direction="2"
                mode="normal"
              ></lottie-player>
              <div class="caracter-description">
                <span>Newbie</span>
              </div>
            </div>
            <div id="caracter-lvl-2" class="caracter-container">
              <lottie-player
                id="ajolote-2-discover-animation"
                class="caracter-animation caracter"
                src="https://growth-cdn.business-systems-rappicard.mx/Gamification/Nivel-2-Icono.json"
                background="transparent"
                speed="1"
                direction="2"
                mode="normal"
              ></lottie-player>
              <div class="caracter-description">
                <span>Aprendiz</span>
              </div>
            </div>
            <div id="caracter-lvl-3" class="caracter-container">
              <lottie-player
                id="ajolote-3-discover-animation"
                class="caracter-animation caracter"
                src="https://growth-cdn.business-systems-rappicard.mx/Gamification/Nivel-3-Icono.json"
                background="transparent"
                speed="1"
                direction="2"
                mode="normal"
              ></lottie-player>
              <div class="caracter-description">
                <span>Amateur</span>
              </div>
            </div>
            <div id="caracter-lvl-4" class="caracter-container">
              <lottie-player
                id="ajolote-4-discover-animation"
                class="caracter-animation caracter"
                src="https://growth-cdn.business-systems-rappicard.mx/Gamification/Nivel-4-Icono.json"
                background="transparent"
                speed="1"
                direction="2"
                mode="normal"
              ></lottie-player>
              <div class="caracter-description">
                <span>Wizard</span>
              </div>
            </div>
          </div>
          <div class="column rewards-column">
            <div id="progress-rewards" class="progress">
              <img
                src="./icono-info.svg"
                class="info-tag tag-1"
                onclick="openModalInfo(1)"
              />
              <div class="chest chest-1"></div>
              <img
                src="./icono-info.svg"
                class="info-tag tag-2"
                onclick="openModalInfo(2)"
              />
              <div class="chest chest-2"></div>
              <img
                src="./icono-info.svg"
                class="info-tag tag-3"
                onclick="openModalInfo(3)"
              />
              <div class="chest chest-3"></div>
              <img
                src="./icono-info.svg"
                class="info-tag tag-4"
                onclick="openModalInfo(4)"
              />
              <div class="chest chest-4"></div>
              <img
                class="progressBar"
                src="https://growth-cdn.business-systems-rappicard.mx/Gamification/progressBar-Level-2.png"
                alt=""
              />
            </div>
            <div class="progressBar-rewards">
              <div class="lvl-1-rewards rewards">
                <p>Premios</p>
                <ul>
                  <li>cashback</li>
                  <li>MSI</li>
                </ul>
              </div>
              <div class="lvl-2-rewards rewards">
                <p>Premios</p>
                <ul>
                  <li>cashback</li>
                  <li>MSI</li>
                </ul>
              </div>
              <div class="lvl-3-rewards rewards">
                <p>Premios</p>
                <ul>
                  <li>cashback</li>
                  <li>MSI</li>
                </ul>
              </div>
              <div class="lvl-4-rewards rewards">
                <p>Premios</p>
                <ul>
                  <li>cashback</li>
                  <li>MSI</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script src="./campañas.js"></script>
  <script>
    // Objeto que rellena toda la información de la app
    // --------------------------------------
    let object = {
      resultado: {
        isFirstTime: false /* boleano */,
        Logros: {
          Nivel: 5 /* Entero mayor a 0 */,
          hasFailed: false /* boleano */,
          semana: 1 /* Entero mayor a 0 */,
          comercio: "" /* String */,
        },
      },
      premioActual: "3% de cashback del 20 al 28 de Junio." /* String */,
      metaActual: "Haz una compra a MSI" /* String */,
      premios: {
        1: "Ganaste Premio 1",
        2: "Ganaste Premio 2",
        3: "Ganaste Premio 3",
        4: "Ganaste Premio 4",
        5: "Ganaste Premio 5",
        6: "Ganaste Premio 6",
        7: "Ganaste Premio 7",
      },
    };
    // --------------------------------------

    const { Nivel, hasFailed, semana, comercio } = object.resultado.Logros;
    const { premioActual, metaActual, premios } = object;
    const { isFirstTime } = object.resultado;

    const caracterModal = document.querySelector(".caracter-modal");
    document.getElementById("meta-actual-text").innerText = metaActual;
    document
      .getElementById("close-button-modal")
      .addEventListener("click", () => {
        caracterModal.style.opacity = 0;
        setTimeout(() => {
          caracterModal.style.display = "none";
        }, 250);
      });
    const modalInfoCloseButton = document.getElementById("close-modal-info");
    modalInfoCloseButton.addEventListener("click", closeModalInfo);
    function openModalInfo(currentLevel) {
      modalInfo = document.querySelector(".modal-info");
      overlay = document.querySelector(".modal-overlay");
      modalInfo.style.opacity = 1;
      overlay.style.opacity = 1;
      modalInfo.style.display = "block";
      overlay.style.display = "block";
      document.getElementById("premio-info-container").textContent =
        premios[currentLevel];
      document.getElementById("chest-info-container").src =
        currentLevel >= 4
          ? `https://growth-cdn.business-systems-rappicard.mx/Gamification/cofre-nivel-4.png`
          : `https://growth-cdn.business-systems-rappicard.mx/Gamification/cofre-nivel-${currentLevel}.png`;
    }
    function inscriptionApiRewards(promoSeleccionada) {
      console.log(promoSeleccionada);
      let campañaAsignada = campañas[promoSeleccionada];
      console.log(campañaAsignada);
      //   const rewardsAPI = () => {

      //   let result = fetch(
      //     "https://rewards-mx.dev-k8s.rappipay.com.mx/rewards/mx/btb/api/v1/MX/campaigns/wl/list-users",
      //     {
      //       method: "POST",
      //       headers: {
      //         "Content-Type": "application/json",
      //         Authorization:
      //           "Basic cnBwLWdyb3d0aC1yYXBwaS1jYXJkLW14LWhvdC1zYWxlOjNhOWU1YzYwZDNmN2I4ZWE4OGUxMjc5N2JhZjZmOGRl",
      //       },
      //       body: JSON.stringify([
      //         {
      //           user_id: "4116948e-67e0-4d6c-bde7-b1dbb086c189",
      //           campaign_id: campañaAsignada.refund_1_digito,
      //           type_list: "WL",
      //           active: true,
      //         },
      //         {
      //           user_id: "4116948e-67e0-4d6c-bde7-b1dbb086c189",
      //           campaign_id: campañaAsignada.post_1_digito,
      //           type_list: "WL",
      //           active: true,
      //         },
      //         {
      //           user_id: "4116948e-67e0-4d6c-bde7-b1dbb086c189",
      //           campaign_id: campañaAsignada.refund_2_digitos,
      //           type_list: "WL",
      //           active: true,
      //         },
      //         {
      //           user_id: "4116948e-67e0-4d6c-bde7-b1dbb086c189",
      //           campaign_id: campañaAsignada.post_2_digitos,
      //           type_list: "WL",
      //           active: true,
      //         },
      //         {
      //           user_id: "4116948e-67e0-4d6c-bde7-b1dbb086c189",
      //           campaign_id: campañaAsignada.refund_3_digitos,
      //           type_list: "WL",
      //           active: true,
      //         },
      //         {
      //           user_id: "4116948e-67e0-4d6c-bde7-b1dbb086c189",
      //           campaign_id: campañaAsignada.post_3_digitos,
      //           type_list: "WL",
      //           active: true,
      //         },
      //         {
      //           user_id: "4116948e-67e0-4d6c-bde7-b1dbb086c189",
      //           campaign_id: campañaAsignada.refund_4_digitos,
      //           type_list: "WL",
      //           active: true,
      //         },
      //         {
      //           user_id: "4116948e-67e0-4d6c-bde7-b1dbb086c189",
      //           campaign_id: campañaAsignada.post_4_digitos,
      //           type_list: "WL",
      //           active: true,
      //         },
      //         // comercios
      //         {
      //           user_id: "4116948e-67e0-4d6c-bde7-b1dbb086c189",
      //           campaign_id:
      //             campañasComercios.todosLosComercios.post_todosLosComercios,
      //           type_list: "WL",
      //           active: true,
      //         },
      //         {
      //           user_id: "4116948e-67e0-4d6c-bde7-b1dbb086c189",
      //           campaign_id:
      //             campañasComercios.todosLosComercios.refund_todosLosComercios,
      //           type_list: "WL",
      //           active: true,
      //         },
      //         {
      //           user_id: "4116948e-67e0-4d6c-bde7-b1dbb086c189",
      //           campaign_id: campañasComercios.Amazon.post_Amazon,
      //           type_list: "WL",
      //           active: true,
      //         },
      //         {
      //           user_id: "4116948e-67e0-4d6c-bde7-b1dbb086c189",
      //           campaign_id: campañasComercios.Amazon.refund_Amazon,
      //           type_list: "WL",
      //           active: true,
      //         },
      //       ]),
      //     }
      //   )
      //     .then((response) => {
      //       if (!response.ok) {
      //         throw new Error(
      //           "Network response was not ok " + response.statusText
      //         );
      //       }
      //       console.log("holas");
      //       return response.json();
      //     })
      //     .then((data) => {
      //       console.log(data);
      //     })
      //     .catch((error) => {
      //       console.error(
      //         "There was a problem with the fetch operation: ",
      //         error
      //       );
      //     });
      // };
    }
    function closeModalInfo() {
      modalInfo = document.querySelector(".modal-info");
      overlay = document.querySelector(".modal-overlay");
      modalInfo.style.opacity = 0;
      overlay.style.opacity = 0;
      setTimeout(() => {
        modalInfo.style.display = "none";
        overlay.style.display = "none";
      }, 500);
    }
    function createLevelElement(level, isFirstTime) {
      // Crear el elemento <div> principal
      const caracterReachedLoop = document.createElement("div");
      caracterReachedLoop.addEventListener("click", () => {
        updateModalContent(level, hasFailed);
      });
      caracterReachedLoop.id = `caracter-reached-loop-${level}`;
      caracterReachedLoop.className = "caracter-container caracter-loop";

      // Crear el elemento de caracter
      let caracterElement;
      if (isFirstTime) {
        // Usar lottie-player si es la primera vez
        caracterElement = document.createElement("lottie-player");
        caracterElement.setAttribute(
          "id",
          `ajolote-${level}-discover-animation`
        );
        caracterElement.setAttribute(
          "src",
          "https://growth-cdn.business-systems-rappicard.mx/Gamification/Nivel-4-Icono.json"
        ); // Siempre usar el JSON del nivel 4
        caracterElement.setAttribute("background", "transparent");
        caracterElement.setAttribute("speed", "1");
        caracterElement.setAttribute("direction", "1");
        caracterElement.setAttribute("mode", "normal");
        caracterElement.setAttribute("autoplay", "true");
        setTimeout(() => {
          document.querySelector(".caracter-modal").style.display = "flex";
          setTimeout(() => {
            updateModalContent(level, hasFailed);
            document.querySelector(".caracter-modal").style.opacity = 1;
          }, 100);
        }, 5000);
      } else {
        // Usar una imagen estática
        caracterElement = document.createElement("img");
        caracterElement.src =
          "https://growth-cdn.business-systems-rappicard.mx/Gamification/AJO-LVL-4.png"; // Siempre usar la imagen del nivel 4
        caracterElement.alt = `Ajolote Nivel ${level}`;
        caracterElement.className = "caracter";
        caracterElement.style.padding = "28.1px 0";
      }

      // Crear el elemento <div> para la descripción
      const caracterDescription = document.createElement("div");
      caracterDescription.className = "caracter-description";
      const spanElement = document.createElement("span");
      spanElement.textContent = "Wizard";
      caracterDescription.appendChild(spanElement);

      // Anidar elementos dentro del <div> principal
      caracterReachedLoop.appendChild(caracterElement);
      caracterReachedLoop.appendChild(caracterDescription);

      return caracterReachedLoop;
    }

    function handleLevelAnimation(level, isFirstTime) {
      if (isFirstTime) {
        // Ejecutar la animación solo si es la primera vez en el nivel especificado
        const lottiePlayer = document.getElementById(
          `ajolote-${level}-discover-animation`
        );
        if (lottiePlayer) {
          lottiePlayer.play();
        }
        setTimeout(() => {
          document.querySelector(".caracter-modal").style.display = "flex";
          setTimeout(() => {
            updateModalContent(level, hasFailed);
            document.querySelector(".caracter-modal").style.opacity = 1;
          }, 100);
        }, 5000);
      }
    }

    const AddEmptyLevelLoop = () => {
      console.log("hoall");
      //convertir a crear el elemento en vez de copiar el nodo ("esta creando uno rellenado")
      let progressBoxContainer = document.getElementById("progress-rewards");
      let progressCaracterContainer =
        document.querySelector(".caracter-column");
      let progressRewardsContainer = document.querySelector(
        ".progressBar-rewards"
      );
      // Crear el elemento <img>
      let progressEmptyBox = document.createElement("img");

      // Establecer atributos del elemento
      progressEmptyBox.id = "firstLoopChild";
      progressEmptyBox.className = "progress-loop-part";
      progressEmptyBox.src =
        "https://braze-images.com/appboy/communication/assets/image_assets/images/66bc41d01207fb0064661ab0/original.png?1723613647";
      progressEmptyBox.alt = "";
      let caracterContainer = document.createElement("div");

      // Establecer la clase para el <div>
      caracterContainer.className = "caracter-container";

      // Crear el elemento <lottie-player>
      let lottiePlayer = document.createElement("lottie-player");

      // Establecer atributos para <lottie-player>
      lottiePlayer.id = "ajolote-4-discover-animation";
      lottiePlayer.className = "caracter-animation caracter";
      lottiePlayer.setAttribute(
        "src",
        "https://growth-cdn.business-systems-rappicard.mx/Gamification/Nivel-4-Icono.json"
      );
      lottiePlayer.setAttribute("background", "transparent");
      lottiePlayer.setAttribute("speed", "1");
      lottiePlayer.setAttribute("direction", "2");
      lottiePlayer.setAttribute("mode", "normal");

      // Crear el elemento <div> para la descripción
      let caracterDescription = document.createElement("div");
      caracterDescription.className = "caracter-description";

      // Crear el elemento <span> dentro de la descripción
      let spanElement = document.createElement("span");
      spanElement.textContent = "Wizard";

      // Anidar el <span> dentro de la descripción
      caracterDescription.appendChild(spanElement);
      caracterContainer.appendChild(lottiePlayer);
      caracterContainer.appendChild(caracterDescription);

      // Crear el elemento <div> principal
      let rewardsLoop = document.createElement("div");

      // Establecer atributos para el <div>
      rewardsLoop.id = "rewards-loop";
      rewardsLoop.className = "lvl-4-rewards rewards rewards-loop";

      // Crear el elemento <p> y establecer su contenido
      let paragraph = document.createElement("p");
      paragraph.textContent = "Premios";

      // Crear el elemento <ul>
      let ulElement = document.createElement("ul");

      // Crear el primer elemento <li> y establecer su contenido
      let liCashback = document.createElement("li");
      liCashback.textContent = "cashback";

      // Crear el segundo elemento <li> y establecer su contenido
      let liMSI = document.createElement("li");
      liMSI.textContent = "MSI";

      // Anidar los elementos <li> dentro de <ul>
      ulElement.appendChild(liCashback);
      ulElement.appendChild(liMSI);

      // Anidar el <p> y el <ul> dentro del <div> principal
      rewardsLoop.appendChild(paragraph);
      rewardsLoop.appendChild(ulElement);

      let numElementos = progressBoxContainer.children.length;
      progressEmptyBox.style.zIndex = -numElementos;
      progressBoxContainer.appendChild(progressEmptyBox);
      progressCaracterContainer.appendChild(caracterContainer);
      progressRewardsContainer.appendChild(rewardsLoop);
      setTimeout(() => {
        // Hacer scroll al final del modal
        progressBoxContainer.lastElementChild.scrollIntoView({
          behavior: "smooth",
        });
      }, 1200);
    };

    function updateModalContent(level, hasFailed) {
      const modalTitle = document.getElementById("modal-title");
      const modal = document.querySelector(".caracter-modal");
      const lottieContainer = document.querySelector(".modal-lottie-container");
      const recompensaText = document.querySelector(".recompensa-description");
      const modalButton = document.getElementById("modal-button");
      const modalCloseButton = document.getElementById("close-button-modal");
      const comercioSelector = document.querySelector(".comercios-container");
      const recompensaContainer = document.querySelector(
        ".recompensa-container"
      );
      if (hasFailed) {
        // Usar una imagen si falló
        modalTitle.textContent = `AJO te extraña`;
        const imgElement = document.createElement("img");
        imgElement.src = `https://growth-cdn.business-systems-rappicard.mx/Gamification/AJO-LVL-${
          level >= 4 ? "1" : level
        }-TRISTE.png`; // Imagen de falla o imagen estática
        imgElement.alt = `Ajolote Nivel ${level}`;

        // Que no lo agregué así nomas, que añada el titulo, texto de la descripción y el botón
        lottieContainer.innerHTML = "";
        lottieContainer.appendChild(imgElement);
      } else {
        // Usar lottie-player si no falló
        modalTitle.innerHTML = `¡GANASTE!<br>Nivel ${level}`;
        comercioSelector.style.display = "none";
        recompensaContainer.style.marginBottom = "50px";
        const newLottiePlayer = document.createElement("lottie-player");
        const lottieSrc =
          level <= 4
            ? `https://growth-cdn.business-systems-rappicard.mx/Gamification/Ajolote-Nivel-${level}-Animacion.json`
            : `https://growth-cdn.business-systems-rappicard.mx/Gamification/Ajolote-Nivel-4-Animacion.json`;
        newLottiePlayer.setAttribute("src", lottieSrc);
        newLottiePlayer.setAttribute("background", "transparent");
        newLottiePlayer.setAttribute("speed", "1");
        newLottiePlayer.setAttribute("direction", "2");
        newLottiePlayer.setAttribute("mode", "normal");
        newLottiePlayer.setAttribute("autoplay", "true");
        newLottiePlayer.setAttribute("loop", "true");
        lottieContainer.innerHTML = "";
        lottieContainer.appendChild(newLottiePlayer);
        if (level >= 4 && comercio.length === 0) {
          modalCloseButton.style.display = "none";
          modalButton.style.opacity = 0;
          comercioSelector.style.display = "flex";
          recompensaContainer.style.marginBottom = "0px";
          const images = document.querySelectorAll(".comercios-container div");
          let promoSeleccionada = "";
          images.forEach((image) => {
            image.addEventListener("click", function () {
              //Aquí se guarda la selección
              promoSeleccionada = image.id;
              images.forEach((img) => img.classList.remove("selected"));
              image.classList.add("selected");
              modalButton.style.opacity = 1;
            });
          });
          modalButton.addEventListener("click", () => {
            inscriptionApiRewards(promoSeleccionada);
          });
          setTimeout(() => {
            // Hacer scroll al modal para que esté en la vista
            comercioSelector.scrollIntoView({ behavior: "smooth" });
          }, 1200);
        }
        //en este else poner el de seleccion en vez del modal
      }
      // Actualizar el texto de la recompensa
      recompensaText.textContent =
        level == Nivel
          ? comercio.length > 0
            ? `Tienes 3% de cashback del 20 al 28 en ${comercio}.`
            : premioActual
          : premios[level].premio;

      // Actualizar el botón si es necesario
      modalButton.textContent = "Usar mi promo";

      // Mostrar el modal
      modal.style.display = "flex";
      setTimeout(() => {
        modal.style.opacity = 1;
      }, 100);
    }

    const AddReachedLevelLoop = (level, isFirstTime, hasFailed) => {
      const progressBoxContainer = document.getElementById("progress-rewards");
      const progressCaracterContainer =
        document.querySelector(".caracter-column");
      const progressRewardsContainer = document.querySelector(
        ".progressBar-rewards"
      );

      // -- Barra de progreso llena

      // Crear el elemento <img>
      // Crear el elemento <div>
      let infoTag = document.createElement("img");

      // Establecer la clase del elemento
      infoTag.className = "info-tag info-tag-newLevel";
      infoTag.src = "./icono-info.svg";

      // Añadir el nuevo elemento al contenedor progressBoxContainer
      let progressFilledBoxContainer = document.createElement("div");
      progressFilledBoxContainer.className = "progressFilledBoxContainer";
      let progressEmptyBox = document.createElement("img");

      // Establecer atributos del elemento
      progressEmptyBox.id = "firstLoopFilledChild";
      progressEmptyBox.className = "progress-loop-part";
      progressEmptyBox.src =
        "https://braze-images.com/appboy/communication/assets/image_assets/images/66bc41d05e5ed80063b59f20/original.png?1723613648";
      progressEmptyBox.alt = "";

      let numElementos = progressBoxContainer.children.length;
      progressFilledBoxContainer.style.zIndex = -numElementos;
      progressFilledBoxContainer.appendChild(progressEmptyBox);
      progressFilledBoxContainer.appendChild(infoTag);
      progressBoxContainer.appendChild(progressFilledBoxContainer);

      // Añadir el evento click para mostrar el modal con el contenido dinámico
      progressEmptyBox.addEventListener("click", () => {
        updateModalContent(level, hasFailed);
      });

      infoTag.addEventListener("click", () => {
        openModalInfo(level);
      });

      // -- Añade personaje descubierto

      // Crear y añadir el elemento de nivel usando la función auxiliar
      const caracterReachedLoop = createLevelElement(level, isFirstTime);
      progressCaracterContainer.appendChild(caracterReachedLoop);

      //  -- Texto Recompensas

      // Crear el elemento <div> principal para recompensas
      const rewardsLoop = document.createElement("div");
      rewardsLoop.id = `rewards-loop-${level}`;
      rewardsLoop.className = "lvl-4-rewards rewards rewards-loop";

      // Crear el elemento <p> y establecer su contenido
      const paragraph = document.createElement("p");
      paragraph.textContent = "Premios";

      // Crear el elemento <ul>
      const ulElement = document.createElement("ul");

      // Crear los elementos <li> y establecer su contenido
      const liCashback = document.createElement("li");
      liCashback.textContent = "cashback";

      const liMSI = document.createElement("li");
      liMSI.textContent = "MSI";

      // Anidar los elementos <li> dentro de <ul>
      ulElement.appendChild(liCashback);
      ulElement.appendChild(liMSI);

      // Anidar el <p> y el <ul> dentro del <div> principal
      rewardsLoop.appendChild(paragraph);
      rewardsLoop.appendChild(ulElement);

      // Añadir elementos al DOM
      progressRewardsContainer.appendChild(rewardsLoop);
    };

    function showFirst4Levels(level) {
      for (let index = 1; index <= level; index++) {
        if (index > 4) return;
        const container = document.getElementById(`caracter-lvl-${index}`);
        container.style.marginTop = level == 1 ? "-10px" : "0px";
        const chestContainer = document.querySelector(`.chest-${index}`);
        const handleClickModal = () => {
          updateModalContent(index, hasFailed);
        };
        if (chestContainer)
          chestContainer.addEventListener("click", handleClickModal);
        if (container) container.addEventListener("click", handleClickModal);

        const lottiePlayer = document.getElementById(
          `ajolote-${index}-discover-animation`
        );
        // Verificar si es la primera vez en el nivel
        if (index === level && isFirstTime) {
          // Reproducir la animación si es la primera vez
          handleLevelAnimation(index, true);
          return; // Termina la función después de reproducir la animación
        } else {
          // Reemplazar el Lottie Player por una imagen si no es la primera vez
          const imgElement = document.createElement("img");

          // Establecer los atributos del nuevo <img>
          imgElement.id = `ajolote-${index}-discover-image`;
          imgElement.className = "caracter";
          imgElement.src = `https://growth-cdn.business-systems-rappicard.mx/Gamification/AJO-LVL-${index}.png`; // Cambia la ruta a la imagen que quieres usar
          imgElement.alt = `Ajolote Nivel ${index}`;
          imgElement.style.padding = index == 1 ? "0 0 28.1px 0" : "28.1px 0";

          // Reemplazar el Lottie Player con la imagen
          container.replaceChild(imgElement, lottiePlayer);
        }
      }
    }
    const generateNewLevel = (level) => {
      showFirst4Levels(level);
      document.querySelector(".progressBar").src =
        level < 4
          ? `https://growth-cdn.business-systems-rappicard.mx/Gamification/progressBar-Level-${level}.png`
          : `https://growth-cdn.business-systems-rappicard.mx/Gamification/progressBar-Level-4.png`;

      if (level >= 4) {
        for (let index = 5; index <= level; index++) {
          if (index === level) {
            AddReachedLevelLoop(level, isFirstTime ? true : false, hasFailed);
            AddEmptyLevelLoop();
            return;
          }
          AddReachedLevelLoop(index, false);
        }
      }
      // AddEmptyLevelLoop();
    };
    generateNewLevel(Nivel);
  </script>
</html>
